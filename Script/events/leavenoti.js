module.exports.config = {
  name: "leave",
  eventType: ["log:unsubscribe"],
  version: "3.0.0",
  credits: "Chander Pahar x Gemini",
  description: "ржЧрзНрж░рзБржк ржерзЗржХрзЗ ржХрзЗржЙ рж▓рж┐ржн ржирж┐рж▓рзЗ ржмрж╛ ржХрж┐ржХ ржЦрзЗрж▓рзЗ ржЪрж░ржо рж▓рзЗржнрзЗрж▓рзЗрж░ рж░рзЛрж╕рзНржЯ ржУ ржЕржкржорж╛ржи ржХрж░рж╛",
  dependencies: {
    "fs-extra": "",
    "path": ""
  }
};

module.exports.run = async function({ api, event, Users, Threads }) {
  if (event.logMessageData.leftParticipantFbId == api.getCurrentUserID()) return;

  const { createReadStream, existsSync, mkdirSync } = global.nodemodule["fs-extra"];
  const { join } = global.nodemodule["path"];
  const { threadID } = event;
  const leftID = event.logMessageData.leftParticipantFbId;

  const data = global.data.threadData.get(parseInt(threadID)) || (await Threads.getData(threadID)).data;
  const name = global.data.userName.get(leftID) || await Users.getNameUser(leftID);

  // ржХрж┐ржХ ржжрзЗржУрзЯрж╛ ржмрж╛ рж▓рж┐ржн ржирзЗржУрзЯрж╛рж░ ржЬржирзНржп ржмрзЬ ржУ ржлрж╛ржирж┐ ржЕржкржорж╛ржиржЬржиржХ ржорзЗрж╕рзЗржЬ
  const type = (event.author == leftID)
    ? "рждрзЛрж░ ржПрждрзЛ ржмрзЬ рж╕рж╛рж╣рж╕! рждрзБржЗ ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛рзЬрзЗрж░ ржПржбржорж┐ржирзЗрж░ ржкрж╛рж░ржорж┐рж╢ржи ржЫрж╛рзЬрж╛ржЗ ржЧрзНрж░рзБржк ржерзЗржХрзЗ ржкрж╛рж▓рж╛рж▓рж┐? ЁЯШбЁЯШаЁЯдм рждрзЛрж░ ржорждрзЛ ржЖржмрж╛рж▓ ржПржЗ ржЧрзНрж░рзБржкрзЗ ржерж╛ржХрж╛рж░ ржпрзЛржЧрзНржпржЗ ржирж╛! рж░рж╛рж╕рзНрждрж╛ ржорж╛ржк ржЖрж░ ржЧрж┐рзЯрзЗ ржмрзЬ ржмрзЬ ржШрж╛рж╕ ржЦрж╛ ржЫрж╛ржЧрж▓! рждрзЛрж░ ржХржкрж╛рж▓рзЗ ржЬрзБржЯржмрзЗ ржПржЦржи рж╢рзБржзрзБ ржкржЪрж╛ ржмрзЗржЧрзБржи ржЖрж░ ржмрж╛ржБрж╢рзЗрж░ рж▓рж╛ржарж┐! ржЖржмрж╛рж░ ржпржжрж┐ ржПржжрж┐ржХрзЗ ржЖрж╕рж┐рж╕, рждржмрзЗ ржХрж╛ржи ржзрж░рзЗ ржУржаржмрж╕ ржХрж░рж┐рзЯрзЗ ржЭрж╛рзЬрзБ ржжрж┐рзЯрзЗ ржкрж┐ржЯрж╛ржирзЛ рж╣ржмрзЗ! ржпрж╛ ржнрж╛ржЧ ржПржЦрж╛ржи ржерзЗржХрзЗ! ЁЯРРЁЯТйЁЯТи"
    : "ржПржЗ ржЧрзНрж░рзБржкрзЗ ржерж╛ржХрж╛рж░ ржХрзЛржирзЛ ржпрзЛржЧрзНржпрждрж╛ рждрзЛрж░ ржирзЗржЗ рж░рзЗ ржЖржмрж╛рж▓! ЁЯШб рждрзЛрж░ ржорзБржЦ ржжрзЗржЦрж▓рзЗржЗ ржЧрзНрж░рзБржкрзЗрж░ ржкрж░рж┐ржмрзЗрж╢ ржирж╖рзНржЯ рж╣рзЯ, рждрж╛ржЗ ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛рзЬрзЗрж░ ржкрж╛ржУрзЯрж╛рж░ржлрзБрж▓ ржПржбржорж┐ржи рждрзЛржХрзЗ рж╕ржЬрзЛрж░рзЗ ржПржХржЯрж╛ рж▓рж╛ржерж┐ ржорзЗрж░рзЗ ржирж░рзНржжржорж╛рзЯ ржлрзЗрж▓рзЗ ржжрж┐рж▓рзЛ! ЁЯдк WELLCOME TO BANISHMENT! ЁЯдз ржПржЦржи ржЧрж┐рзЯрзЗ ржЖрзЯржирж╛рзЯ ржирж┐ржЬрзЗрж░ ржЪрзЗрж╣рж╛рж░рж╛ ржжрзЗржЦ ржЖрж░ ржЪрзЛржЦрзЗрж░ ржЬрж▓ ржлрзЗрж▓! рждрзЛрж░ ржорждрзЛ ржлрж╛ржЙрж▓ ржорзЗржорзНржмрж╛рж░ржХрзЗ ржЫрж╛рзЬрж╛ржЗ ржПржЗ ржЧрзНрж░рзБржк ржПржЦржи рж╕рзНржмрж░рзНржЧрзЗрж░ ржорждрзЛ рж╢рж╛ржирзНржд ржерж╛ржХржмрзЗ! ржЯрж╛-ржЯрж╛ ржмрж╛ржЗ-ржмрж╛ржЗ, ржбрзНрж░рзЗржирзЗ ржЧрж┐рзЯрзЗ рж╣рж╛ржмрзБржбрзБржмрзБ ржЦрж╛! ЁЯСЮЁЯТеЁЯПГтАНтЩВя╕ПЁЯТи";

  const path = join(__dirname, "cache", "leaveGif");
  const gifPath = join(path, `leave.gif`);

  if (!existsSync(path)) mkdirSync(path, { recursive: true });

  // ржлрж╛ржЗржирж╛рж▓ ржорзЗрж╕рзЗржЬ ржбрж┐ржЬрж╛ржЗржи
  let msg = `ржЖрж╣рж╛рж░рзЗ {name}! ЁЯдз\nЁЯЖФ ржЗржЙржЬрж╛рж░ ржЖржЗржбрж┐: ${leftID}\n\n{type}\n\nтФДтФЙтЭИтЬбя╕ПтЛЖтГЭржЪрж╛ржБржжрзЗржбрж╝~ржкрж╛рж╣рж╛ржбрж╝тЬ┐тГЭЁЯкмтЭИтФЙтФД`;

  msg = msg.replace(/\{name}/g, name).replace(/\{type}/g, type);

  const formPush = existsSync(gifPath)
    ? { body: msg, attachment: createReadStream(gifPath) }
    : { body: msg };

  return api.sendMessage(formPush, threadID);
};
    
